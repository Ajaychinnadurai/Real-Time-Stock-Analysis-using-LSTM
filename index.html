<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Analysis â€” LSTM</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  /* â”€â”€â”€ RESET & VARIABLES â”€â”€â”€ */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg-deep:      #0a0e1a;
    --bg-card:      #111827;
    --bg-card-alt:  #141e33;
    --border:       rgba(255,255,255,0.06);
    --accent:       #4f8bff;
    --accent-glow:  rgba(79,139,255,0.25);
    --accent2:      #34d399;
    --accent2-dim:  rgba(52,211,153,0.2);
    --red:          #f87171;
    --red-dim:      rgba(248,113,113,0.2);
    --text-primary: #f1f5f9;
    --text-muted:   #64748b;
    --text-subtle:  #94a3b8;
    --font-head:    'Syne', sans-serif;
    --font-body:    'DM Sans', sans-serif;
    --radius:       14px;
    --transition:   .3s cubic-bezier(.4,0,.2,1);
  }

  body {
    font-family: var(--font-body);
    background: var(--bg-deep);
    color: var(--text-primary);
    min-height: 100vh;
    padding: 28px 32px;
    overflow-x: hidden;
  }

  /* â”€â”€â”€ AMBIENT BG BLOBS â”€â”€â”€ */
  body::before, body::after {
    content: '';
    position: fixed;
    border-radius: 50%;
    filter: blur(120px);
    pointer-events: none;
    z-index: 0;
  }
  body::before {
    width: 500px; height: 500px;
    background: rgba(79,139,255,0.08);
    top: -150px; left: -150px;
  }
  body::after {
    width: 400px; height: 400px;
    background: rgba(52,211,153,0.06);
    bottom: -100px; right: -100px;
  }

  .page-wrap { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
    flex-wrap: wrap;
    gap: 16px;
  }

  .logo-row { display: flex; align-items: center; gap: 12px; }

  .logo-icon {
    width: 42px; height: 42px;
    background: linear-gradient(135deg, var(--accent), #7ab8ff);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 4px 18px var(--accent-glow);
  }

  .title-block h1 {
    font-family: var(--font-head);
    font-size: 22px; font-weight: 700;
    letter-spacing: -.5px;
    color: var(--text-primary);
  }
  .title-block p {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 1px;
    letter-spacing: .3px;
    text-transform: uppercase;
  }

  /* â”€â”€â”€ SEARCH â”€â”€â”€ */
  .search-wrap { position: relative; }

  .search-wrap input {
    width: 260px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 11px 16px 11px 42px;
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 14px;
    outline: none;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .search-wrap input::placeholder { color: var(--text-muted); }
  .search-wrap input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-glow);
  }
  .search-icon {
    position: absolute; left: 13px; top: 50%; transform: translateY(-50%);
    color: var(--text-muted); font-size: 16px; pointer-events: none;
  }

  /* suggestions */
  #suggestions {
    position: absolute;
    top: calc(100% + 6px);
    left: 0; width: 100%;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    box-shadow: 0 12px 32px rgba(0,0,0,.4);
    list-style: none;
    overflow: hidden;
    z-index: 50;
    animation: dropIn .18s ease;
  }
  @keyframes dropIn {
    from { opacity:0; transform: translateY(-6px); }
    to   { opacity:1; transform: translateY(0); }
  }
  #suggestions li {
    padding: 10px 16px;
    font-size: 14px;
    cursor: pointer;
    color: var(--text-subtle);
    transition: background var(--transition), color var(--transition);
    border-bottom: 1px solid var(--border);
  }
  #suggestions li:last-child { border-bottom: none; }
  #suggestions li:hover {
    background: var(--bg-card-alt);
    color: var(--accent);
  }

  /* â”€â”€â”€ STATS ROW â”€â”€â”€ */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 14px;
    margin-bottom: 20px;
  }
  .stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 18px 20px;
    opacity: 0;
    transform: translateY(12px);
    transition: opacity .35s ease, transform .35s ease;
  }
  .stat-card.visible { opacity: 1; transform: translateY(0); }
  .stat-card .stat-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: .8px;
    color: var(--text-muted);
    margin-bottom: 6px;
  }
  .stat-card .stat-value {
    font-family: var(--font-head);
    font-size: 22px;
    font-weight: 700;
  }
  .stat-card .stat-badge {
    display: inline-block;
    font-size: 11px;
    font-weight: 500;
    border-radius: 20px;
    padding: 2px 8px;
    margin-top: 6px;
  }
  .badge-green { background: var(--accent2-dim); color: var(--accent2); }
  .badge-red   { background: var(--red-dim);     color: var(--red);     }

  /* â”€â”€â”€ MAIN CARD â”€â”€â”€ */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px 26px;
    margin-bottom: 20px;
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .company-name {
    font-family: var(--font-head);
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    opacity: 0;
    transform: translateX(-10px);
    transition: opacity .4s ease, transform .4s ease;
  }
  .company-name.visible { opacity: 1; transform: translateX(0); }

  /* Predict Button */
  #predictBtn {
    display: none;
    align-items: center; gap: 7px;
    background: linear-gradient(135deg, var(--accent), #6fa3ff);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 9px 20px;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: box-shadow var(--transition), transform .15s ease;
    box-shadow: 0 4px 14px var(--accent-glow);
  }
  #predictBtn:hover {
    box-shadow: 0 6px 22px var(--accent-glow);
    transform: translateY(-1px);
  }
  #predictBtn:active { transform: translateY(0); }

  /* Prediction result banner */
  #predictionResult {
    margin-top: 16px;
    font-size: 15px;
    font-weight: 500;
    color: var(--accent2);
    min-height: 22px;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transition: opacity .3s ease;
  }
  #predictionResult.visible { opacity: 1; }
  #predictionResult .pred-badge {
    display: inline-flex;
    align-items: center; gap: 6px;
    background: var(--accent2-dim);
    border-radius: 8px;
    padding: 6px 14px;
    font-family: var(--font-head);
    font-size: 16px;
    font-weight: 600;
  }

  /* â”€â”€â”€ CHART â”€â”€â”€ */
  .chart-wrap {
    position: relative;
    margin-top: 6px;
  }
  canvas { width: 100% !important; max-height: 300px; }

  /* â”€â”€â”€ PLACEHOLDER (empty state) â”€â”€â”€ */
  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    color: var(--text-muted);
    text-align: center;
    gap: 12px;
  }
  .empty-state .empty-icon {
    font-size: 42px;
    opacity: .4;
  }
  .empty-state p {
    font-size: 14px;
    max-width: 320px;
    line-height: 1.6;
  }

  /* â”€â”€â”€ LOADING SPINNER â”€â”€â”€ */
  .spinner {
    width: 18px; height: 18px;
    border: 2px solid var(--accent-glow);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin .55s linear infinite;
    display: inline-block;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€â”€ SCROLLBAR â”€â”€â”€ */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }
</style>
</head>
<body>

<div class="page-wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-row">
      <div class="logo-icon">ğŸ“Š</div>
      <div class="title-block">
        <h1>Stock Analysis</h1>
        <p>LSTM-Powered Predictions</p>
      </div>
    </div>
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="search" placeholder="Search companyâ€¦" autocomplete="off">
      <ul id="suggestions"></ul>
    </div>
  </div>

  <!-- STATS ROW (populated by JS) -->
  <div class="stats-row" id="statsRow"></div>

  <!-- MAIN CARD: company + predict -->
  <div class="card" id="mainCard">
    <div class="empty-state" id="emptyState">
      <div class="empty-icon">ğŸ“ˆ</div>
      <p>Search for a company above to load its historical price data and generate a prediction.</p>
    </div>

    <div id="stockContent" style="display:none;">
      <div class="card-header">
        <div class="company-name" id="companyName"></div>
        <button id="predictBtn">ğŸ”® Predict Tomorrow</button>
      </div>
      <div id="predictionResult"></div>
      <div class="chart-wrap">
        <canvas id="priceChart"></canvas>
      </div>
    </div>
  </div>

</div><!-- /page-wrap -->

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let companies      = [];
let selectedCompany = '';
let chart          = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BOOT â€” load company list
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
fetch('/companies')
  .then(r => r.json())
  .then(d => { companies = d; })
  .catch(() => {});        // silent fail for preview

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SEARCH â€” live suggestions
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const searchInput   = document.getElementById('search');
const suggestionsList = document.getElementById('suggestions');

searchInput.addEventListener('input', function () {
  const val  = this.value.toLowerCase().trim();
  suggestionsList.innerHTML = '';
  if (!val) return;

  const matches = companies.filter(c => c.toLowerCase().includes(val)).slice(0, 6);
  if (!matches.length) return;

  matches.forEach(c => {
    const li       = document.createElement('li');
    li.textContent = c;
    li.onclick     = () => { searchInput.value = ''; loadStock(c); };
    suggestionsList.appendChild(li);
  });
});

// close suggestions on outside click
document.addEventListener('click', e => {
  if (!e.target.closest('.search-wrap')) suggestionsList.innerHTML = '';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LOAD STOCK
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadStock(company) {
  selectedCompany = company;

  fetch(`/stock/${company}`)
    .then(r => r.json())
    .then(data => {
      suggestionsList.innerHTML = '';

      // â”€â”€ show stock content, hide empty â”€â”€
      document.getElementById('emptyState').style.display   = 'none';
      document.getElementById('stockContent').style.display = 'block';

      // â”€â”€ Company name â”€â”€
      const nameEl = document.getElementById('companyName');
      nameEl.textContent = company;
      requestAnimationFrame(() => nameEl.classList.add('visible'));

      // â”€â”€ Stats cards â”€â”€
      const range   = (data.max_price - data.min_price).toFixed(2);
      const avg     = data.avg_close.toFixed(2);
      const lastVal = data.close[data.close.length - 1];

      const statsRow = document.getElementById('statsRow');
      statsRow.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Current / Last Close</div>
          <div class="stat-value" style="color:var(--accent)">â‚¹ ${lastVal}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">52-Week High</div>
          <div class="stat-value" style="color:var(--accent2)">â‚¹ ${data.max_price}
            <span class="stat-badge badge-green">â–² High</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">52-Week Low</div>
          <div class="stat-value" style="color:var(--red)">â‚¹ ${data.min_price}
            <span class="stat-badge badge-red">â–¼ Low</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Close</div>
          <div class="stat-value" style="color:var(--text-subtle)">â‚¹ ${avg}</div>
        </div>
      `;
      // stagger-in
      statsRow.querySelectorAll('.stat-card').forEach((c, i) => {
        setTimeout(() => c.classList.add('visible'), 60 * i);
      });

      // â”€â”€ Chart â”€â”€
      if (chart) chart.destroy();

      const ctx = document.getElementById('priceChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.dates,
          datasets: [{
            label: company + ' â€” Close Price',
            data:  data.close,
            borderColor: 'rgba(79,139,255,1)',
            backgroundColor: 'rgba(79,139,255,0.08)',
            borderWidth: 2,
            pointRadius: 0,
            pointHoverRadius: 4,
            pointHoverBackgroundColor: '#4f8bff',
            tension: 0.35,
            fill: true,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          animation: { duration: 700, easing: 'easeInOutQuart' },
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: {
              labels: { color: '#94a3b8', font: { family: 'DM Sans', size: 12 }, boxWidth: 14 }
            },
            tooltip: {
              backgroundColor: '#1e293b',
              titleColor: '#94a3b8',
              bodyColor: '#4f8bff',
              borderColor: 'rgba(255,255,255,0.08)',
              borderWidth: 1,
              titleFont: { size: 11, family: 'DM Sans' },
              bodyFont: { size: 13, family: 'Syne', weight: '600' },
              cornerRadius: 8,
              padding: 10,
              displayColors: false,
              callbacks: {
                label: ctx => 'â‚¹ ' + ctx.parsed.y.toFixed(2)
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#475569',
                font: { size: 10, family: 'DM Sans' },
                maxTicksLimit: 8,
                maxRotation: 0
              },
              grid: { color: 'rgba(255,255,255,0.04)' },
              border: { color: 'rgba(255,255,255,0.08)' }
            },
            y: {
              position: 'left',
              ticks: {
                color: '#475569',
                font: { size: 11, family: 'DM Sans' },
                callback: v => 'â‚¹ ' + v
              },
              grid: { color: 'rgba(255,255,255,0.04)' },
              border: { color: 'rgba(255,255,255,0.08)' }
            }
          }
        }
      });

      // â”€â”€ Show predict btn â”€â”€
      document.getElementById('predictBtn').style.display = 'inline-flex';
      document.getElementById('predictionResult').className = '';
      document.getElementById('predictionResult').innerHTML = '';
    })
    .catch(() => {});
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PREDICT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('predictBtn').addEventListener('click', function () {
  if (!selectedCompany) return;

  const resultEl = document.getElementById('predictionResult');
  resultEl.innerHTML = '<span class="spinner"></span> Predictingâ€¦';
  resultEl.classList.add('visible');

  fetch(`/predict/${selectedCompany}`)
    .then(r => r.json())
    .then(data => {
      resultEl.innerHTML =
        `<span class="pred-badge">ğŸ“ˆ Tomorrow: â‚¹ ${data.tomorrow_price}</span>`;
      resultEl.classList.add('visible');
    })
    .catch(() => {
      resultEl.innerHTML = '<span style="color:var(--red)">âš  Prediction failed.</span>';
    });
});
</script>
</body>
</html>
